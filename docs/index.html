<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="codemirror.css" rel="stylesheet" />
    <style>
      body {
        margin: 0;
      }

      .og-toolbar {
        position: absolute;
      }

      .og-tooltip {
        position: absolute;
        font-family: Menlo, Consolas, 'DejaVu Sans Mono', monospace;
        color: white;
        font-size: 12px;
        background-color: 528bff;
        box-shadow: 0 2px 8px 1px rgba(0, 0, 0, 0.3);
        padding: 5px;
        border-radius: 2px;
        z-index:10000;
      }

      .og-editor {
        margin-top: 10px;
      }

      .og-editor .CodeMirror{
        margin: 0;
        overflow: hidden;
      }

      .og-console {
        color: rgb(171, 178, 191);
        display: flex;
        align-content: stretch;
        font-family: Menlo, Consolas, 'DejaVu Sans Mono', monospace;
        font-size: 12px;
        background-color: #21252b;
        border-top: solid 2px black;
        margin: 0 0px 10px 0px;
        padding: 4px;
      }

      .og-icon {
        align-self: center;
        flex: 0 1 auto;
        width: 18px;
        height: 20px;
        background-size: 100%;
        display: inline-block;
        vertical-align: middle;
      }

      .og-execute-icon {
        background: url(execute.svg);
        cursor: pointer;
      }
      .og-error-icon {
        background: url(error.svg);
      }

      .og-console-text {
        flex: 1 1 auto;
        color: rgb(171, 178, 191);
        font-family: Menlo, Consolas, 'DejaVu Sans Mono', monospace;
        font-size: 12px;
        line-height: 18px;
        display:inline-block;
        padding-left: 10px;
      }

      @media (min-width: 768px) {
        .CodeMirror.og-editor {
          margin: 0 10px;
          margin-top: 10px;
        }

        .CodeMirror.og-console {
          margin: 0 10px 10px 10px;
        }
      }

      .og-console pre {
        margin: 0;

      }

      .og-highlight {
        color: orangered !important;
        text-decoration: underline;
      }

      .CodeMirror {
        font-size: 12px;
        line-height: 18px;
      }

      .CodeMirror.iOS {
        font-size: 16px;
        line-height: 21px;
      }

      .CodeMirror pre {
      }

      .CodeMirror-hints {
        font-family: Menlo, Consolas, 'DejaVu Sans Mono', monospace;
        position: absolute;
        color: #abb2bf;
        z-index: 10;
        overflow: none;
        list-style: none;
        font-size: 12px;
        margin: 0;
        min-width: 200px;
        overflow-y:auto auto;

        background-color: #282c34;
        box-shadow: 0 2px 8px 1px rgba(0, 0, 0, 0.3);
        padding: 0;
      }

      .CodeMirror-hint {
        margin: 0;
        white-space: nowrap;
        cursor: pointer;
        padding: 5px 0;
        padding-left: 0.6em;
        padding-right: 0.6em;
        min-width: min-content;
      }

      .CodeMirror-hint-kind {
        display:none;
      }

      .CodeMirror-hint-title {
        display:inline-block;
      }

      .CodeMirror-hint-type-info {
        display:inline-block;
        padding-left: 10px;
        color: rgba(171, 178, 191, 0.44);
      }

      li.CodeMirror-hint-active {
        background: #3a3f4b;
        color: white;
      }

      .CodeMirror-activeline-background {
        background-color: transparent;
      }

      .CodeMirror-focused .CodeMirror-activeline-background {
        background-color: rgba(153, 187, 255, 0.04);
      }

      .CodeMirror-hints-doc {
        line-height: 1.3;
        background: #1f2228;
        width: min-content;
        min-width: 100%;
      }

      .CodeMirror-hints-doc-content {
        padding: 5px 0;
        min-height: 2em;
        padding-left: 0.6em;
        padding-right: 0.6em;
      }

    </style>

  </head>
  <body>
    <div data-ocaml>
[@@@part "1"];;
type shape = < area : float >;;

type square = < area : float; width : int >;;
    </div>
    <div data-ocaml>
let numeric_deriv ~delta ~x ~y ~(f: x:float -> y:float -> float) =
  let x' = x +. delta in
  let y' = y +. delta in
  let base = f ~x ~y in
  let dx = (f ~y ~x:x' -. base) /. delta in
  let dy = (f ~x ~y:y' -. base) /. delta in
  (dx,dy)
;;
    </div>
    <div data-ocaml>
type element = Empty | X (* ensure we do not miss cases in patterns *)

(* Whether [row.(c)] for [col0 â‰¤ c < col1] are all set to [X]. *)
let rec is_set_range row col0 col1 =
col0 >= col1 || (row.(col0) = X && is_set_range row (col0 + 1) col1)

(* Whether all [row.(ncol)] .. [row.(ncol + width - 1)] equal [X]. *)
let is_set_sub row col0 width =
col0 + width <= Array.length row
&& is_set_range row col0 (col0 + width)

(* Check that [row.(col0 ..)] conforms the pattern [patt_row]. *)
let rec check_row row col0 patt_row =
if col0 >= Array.length row then
  patt_row = [] (* row exhausted, no pattern must remain *)
else
  match row.(col0) with
  | Empty -> check_row row (col0 + 1) patt_row
  | X ->
     match patt_row with
     | [] -> false
     | nX :: tl ->
        if is_set_sub row col0 nX then
          let col0 = col0 + nX in
          (col0 >= Array.length row || row.(col0) = Empty)
          && check_row row (col0 + 1) tl
        else false

(* Check that each row of the table conforms [patts_row].  It is
 assumed that the length of [patts_row] is equal to the number of
 lines of [table]. *)
let rec check_rows table row0 patts_row =
row0 >= Array.length table
|| (match patts_row with
   | patt_row :: tl -> check_row table.(row0) 0 patt_row
                      && check_rows table (row0 + 1) tl
   | [] -> assert false)

let char_of_element = function
| Empty -> '_'
| X -> 'X'

let print_tbl table =
let print_row r =
  Array.iter (fun e -> print_char '|';
                     print_char(char_of_element e)) r;
  print_string "|\n" in
Array.iter print_row table

let solve patts_row patts_col =
let height = List.length patts_row
and width = List.length patts_col in
let table = Array.make_matrix height width Empty in
(* Generate all possibilities for columns and filter according
   to row patterns.  [patts_col] are the patterns left for the
   current column. *)
let rec gen col row patts_col =
  if col >= width then (
    if check_rows table 0 patts_row then
      print_tbl table
  )
  else
    match patts_col with
    | [] :: rest_patt ->
       (* No pattern left for this column, go to the next one. *)
       gen (col + 1) 0 rest_patt
    | (nX :: tl) :: rest_patt ->
       assert(nX > 0);
       if row + nX <= height then (
         for r = row to row + nX - 1 do
           table.(r).(col) <- X
         done;
         gen col (row + nX + 1) (tl :: rest_patt);
         for r = row to row + nX - 1 do
           table.(r).(col) <- Empty
         done;
         (* Try the same pattern from next row: *)
         gen col (row + 1) patts_col;
       )
    | [] -> assert false
in gen 0 0 patts_col;;
    </div>
    <div data-ocaml>
let possible row col used_rows usedD1 usedD2 =
  not (List.mem row used_rows
   || List.mem (row + col) usedD1
   || List.mem (row - col) usedD2)

let queens_positions n =
  let rec aux row col used_rows usedD1 usedD2 =
    if col > n then [List.rev used_rows]
    else
      (if row < n then aux (row + 1) col used_rows usedD1 usedD2
       else [])
      @ (if possible row col used_rows usedD1 usedD2 then
           aux 1 (col + 1) (row :: used_rows) (row + col :: usedD1)
               (row - col :: usedD2)
         else [])
  in aux 1 1 [] [] [];;
    </div>
    <div data-ocaml>

    </div>
    <div data-ocaml>
module Interval = struct
  type t = | Interval of int * int
           | Empty

  let create low high =
    if high < low then Empty else Interval (low,high)
end;;
module Extended_interval = struct
  include Interval

  let contains t x =
    match t with
    | Empty -> false
    | Interval (low,high) -> x >= low && x <= high
end;;
Extended_interval.contains (Extended_interval.create 3 10) 4;;

    </div>
    <div data-ocaml>let a = 2;;</div>
  </body>
  <script src="./ocaml_gist.js"></script>
</html>
